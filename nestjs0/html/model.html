<!doctype html>
<html lang="zh-CN" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px">
  <head>
    <title>3D模型商品购物车订单管理系统</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue@3.5.0/dist/vue.global.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.13/dayjs.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/element-ui@2.15.14/lib/index.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/element-ui@2.15.14/lib/theme-chalk/index.min.css" rel="stylesheet" />
  </head>

  <main id="app" style="width: 100%; max-width: 1400px; padding: 20px; margin: 0 auto; background: white; border-radius: 15px">
    <!-- 导航标签 -->
    <el-tabs v-model="current_tab" type="card" style="margin-bottom: 20px">
      <el-tab-pane label="3D模型商品" name="product"></el-tab-pane>
      <el-tab-pane label="购物车" name="cart"></el-tab-pane>
      <el-tab-pane label="订单管理" name="order"></el-tab-pane>
    </el-tabs>

    <!-- 商品管理页面 -->
    <div v-if="current_tab === 'product'">
      <!-- 搜索区域 -->
      <el-form :model="product_search_form" style="margin-bottom: 20px">
        <el-row :gutter="20">
          <el-col :span="6">
            <el-form-item label="模型标题">
              <el-input v-model="product_search_form.title" placeholder="搜索模型标题"></el-input>
            </el-form-item>
          </el-col>
          <el-col :span="6">
            <el-form-item label="备注" required>
              <el-input v-model="product_search_form.remark" placeholder="请输入备注"></el-input>
            </el-form-item>
          </el-col>
          <el-col :span="6">
            <el-form-item label="公开状态" required>
              <el-select v-model="product_search_form.is_public" placeholder="请选择状态" style="width: 100%">
                <el-option label="公开" :value="true"></el-option>
                <el-option label="私有" :value="false"></el-option>
              </el-select>
            </el-form-item>
          </el-col>
          <el-col :span="6">
            <el-form-item label="删除状态" required>
              <el-select v-model="product_search_form.is_deleted" placeholder="请选择状态" style="width: 100%">
                <el-option label="未删除" :value="false"></el-option>
                <el-option label="已删除" :value="true"></el-option>
              </el-select>
            </el-form-item>
          </el-col>
          <el-col :span="6">
            <el-form-item label="审核状态" required>
              <el-select v-model="product_search_form.is_check" placeholder="请选择状态" style="width: 100%">
                <el-option label="已审核" :value="true"></el-option>
                <el-option label="未审核" :value="false"></el-option>
              </el-select>
            </el-form-item>
          </el-col>
        </el-row>
        <el-row :gutter="20">
          <el-col :span="6">
            <el-form-item label="商用状态" required>
              <el-select v-model="product_search_form.is_business" placeholder="请选择状态" style="width: 100%">
                <el-option label="全部" :value="null"></el-option>
                <el-option label="商用" :value="true"></el-option>
                <el-option label="非商用" :value="false"></el-option>
              </el-select>
            </el-form-item>
          </el-col>
          <el-col :span="6">
            <el-form-item label="骨骼状态" required>
              <el-select v-model="product_search_form.is_skeleton" placeholder="请选择状态" style="width: 100%">
                <el-option label="全部" :value="null"></el-option>
                <el-option label="有骨骼" :value="true"></el-option>
                <el-option label="无骨骼" :value="false"></el-option>
              </el-select>
            </el-form-item>
          </el-col>
          <el-col :span="6">
            <el-form-item label="动画状态" required>
              <el-select v-model="product_search_form.is_animation" placeholder="请选择状态" style="width: 100%">
                <el-option label="全部" :value="null"></el-option>
                <el-option label="有动画" :value="true"></el-option>
                <el-option label="无动画" :value="false"></el-option>
              </el-select>
            </el-form-item>
          </el-col>
          <el-col :span="6">
            <el-form-item label="打印状态" required>
              <el-select v-model="product_search_form.is_print" placeholder="请选择状态" style="width: 100%">
                <el-option label="全部" :value="null"></el-option>
                <el-option label="可打印" :value="true"></el-option>

                <el-option label="不可打印" :value="false"></el-option>
              </el-select>
            </el-form-item>
          </el-col>
        </el-row>
        <el-row :gutter="20">
          <el-col :span="6">
            <el-form-item label="塌陷状态" required>
              <el-select v-model="product_search_form.is_no_collapse" placeholder="请选择状态" style="width: 100%">
                <el-option label="全部" :value="null"></el-option>
                <el-option label="未塌陷" :value="true"></el-option>
                <el-option label="已塌陷" :value="false"></el-option>
              </el-select>
            </el-form-item>
          </el-col>
          <el-col :span="6">
            <el-form-item label="布线方式" required>
              <el-select v-model="product_search_form.wiring" placeholder="请选择布线" style="width: 100%">
                <el-option label="全部" :value="null"></el-option>
                <el-option label="三角形" value="三角形"></el-option>
                <el-option label="四边形" value="四边形"></el-option>
                <el-option label="混合" value="混合"></el-option>
              </el-select>
            </el-form-item>
          </el-col>
        </el-row>
        <el-row :gutter="20">
          <el-col :span="6">
            <el-form-item label="分类筛选">
              <el-cascader
                v-model="product_search_form.kind_ids"
                :options="kind_tree_options"
                :props="cascader_props"
                placeholder="请选择分类"
                clearable
                multiple
                style="width: 100%"
              ></el-cascader>
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item>
              <el-button type="primary" @click="find_list_model_product">搜索</el-button>
              <el-button @click="reset_search_form">重置</el-button>
            </el-form-item>
          </el-col>
        </el-row>
      </el-form>

      <!-- 管理区域 -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px">
        <h2>3D模型商品管理</h2>
        <el-button type="success" @click="open_add_product_modal">添加模型</el-button>
      </div>

      <!-- 商品列表 -->
      <div>
        <h3>模型列表 /共 {{ product_total_count }} 个模型</h3>
        <div v-if="product_list.length > 0" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(500px, 1fr)); gap: 20px; margin-top: 15px">
          <el-card v-for="product in product_list" :key="product.id" shadow="hover" style="margin-bottom: 20px">
            <div class="product_card_content">
              <!-- 左侧图片 -->
              <div class="product_image_section">
                <div v-if="get_first_image(product)" class="product_image">
                  <img :src="get_first_image(product)" :alt="product.title" @error="handle_image_error" />
                </div>
                <div v-else class="product_image_placeholder">
                  <span>暂无图片</span>
                </div>
              </div>

              <!-- 右侧信息 -->
              <div class="product_info_section">
                <div class="product_header">
                  <h4>{{ product.title }}</h4>
                </div>

                <div class="product_content">
                  <p class="product_remark">{{ product.remark || '暂无描述' }}</p>
                  <div class="product_prices">
                    <div class="price_item personal">个人: ¥{{ product.price_personal }}</div>
                    <div class="price_item company">企业: ¥{{ product.price_company }}</div>
                    <div class="price_item extend">扩展: ¥{{ product.price_extend }}</div>
                  </div>

                  <!-- 模型属性 -->
                  <div class="product_attributes">
                    <div v-if="product.is_skeleton" class="attribute_tag skeleton">有骨骼</div>
                    <div v-if="product.is_animation" class="attribute_tag animation">有动画</div>
                    <div v-if="product.is_business" class="attribute_tag business">商用</div>
                    <div v-if="product.is_print" class="attribute_tag print">可打印</div>
                    <div v-if="product.is_no_collapse" class="attribute_tag no_collapse">未塌陷</div>
                    <div class="attribute_tag">{{ product.area_unit }}</div>
                    <div class="attribute_tag">{{ product.wiring }}</div>
                  </div>

                  <!-- 分类信息 -->
                  <div v-if="product.tb_model_kind && product.tb_model_kind.length > 0" class="product_categories">
                    <div class="category_label">分类:</div>
                    <div class="category_tags">
                      <el-tag v-for="kind in product.tb_model_kind" :key="kind.id" size="small" type="info" style="margin: 2px">
                        {{ kind.name }}
                      </el-tag>
                    </div>
                  </div>

                  <!-- 统计信息 -->
                  <div class="product_stats">
                    <span>收藏: {{ product.count_collect }}</span>
                    <span>下载: {{ product.count_download }}</span>
                    <span>点赞: {{ product.count_like }}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- 底部操作按钮 -->
            <div style="display: flex; gap: 8px; flex-wrap: wrap; align-items: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid #e9ecef">
              <el-button size="small" type="warning" @click="edit_product(product)">编辑</el-button>
              <el-button size="small" type="info" @click="view_product_detail(product)">详情</el-button>
              <el-select :value="get_cart_price_type(product)" @change="update_cart_price_type(product, $event)" size="small" style="width: 100px">
                <el-option label="个人价格" value="price_personal"></el-option>
                <el-option label="企业价格" value="price_company"></el-option>
                <el-option label="扩展价格" value="price_extend"></el-option>
              </el-select>
              <el-button size="small" type="primary" @click="add_to_cart(product)">加入购物车</el-button>
              <el-button size="small" type="danger" @click="delete_model_product(product.id)">删除</el-button>
            </div>
          </el-card>
        </div>
        <el-empty v-else description="暂无模型数据"></el-empty>
      </div>

      <!-- 商品分页 -->
      <el-pagination @current-change="go_to_product_page" :current-page="product_pagination.page_index" :page-size="product_pagination.page_size" :total="product_pagination.count_total" layout="total, prev, pager, next, jumper" style="text-align: center; margin-top: 20px"> </el-pagination>
    </div>

    <!-- 购物车页面 -->
    <div v-if="current_tab === 'cart'">
      <!-- 用户选择 -->
      <el-form :inline="true" style="margin-bottom: 20px">
        <el-form-item label="用户ID">
          <el-input-number v-model="cart_user_id" placeholder="输入用户ID" :min="1"></el-input-number>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="find_list_model_card">查看购物车</el-button>
        </el-form-item>
        <el-form-item>
          <el-button type="warning" @click="clear_model_card" v-if="cart_list.length > 0">清空购物车</el-button>
        </el-form-item>
      </el-form>

      <!-- 购物车列表 -->
      <div>
        <h2>购物车 /共 {{ cart_total_count }} 个商品</h2>
        <div v-if="cart_list.length > 0" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin-top: 15px">
          <el-card v-for="cart_item in cart_list" :key="cart_item.id" shadow="hover" style="margin-bottom: 20px">
            <div class="cart_header">
              <h4>{{ cart_item.product.title }}</h4>
              <div class="price_type">{{ get_price_type_text(cart_item.price_type) }}</div>
            </div>

            <div class="cart_content">
              <p class="product_remark">{{ cart_item.product.remark || '暂无描述' }}</p>
              <div class="cart_price_info">
                <div class="cart_price">价格: ¥{{ cart_item.price }}</div>
                <div class="price_type_badge">{{ get_price_type_text(cart_item.price_type) }}</div>
              </div>

              <!-- 模型属性 -->
              <div class="product_attributes">
                <div v-if="cart_item.product.is_skeleton" class="attribute_tag skeleton">有骨骼</div>
                <div v-if="cart_item.product.is_animation" class="attribute_tag animation">有动画</div>
                <div v-if="cart_item.product.is_business" class="attribute_tag business">商用</div>
                <div v-if="cart_item.product.is_print" class="attribute_tag print">可打印</div>
                <div v-if="cart_item.product.is_no_collapse" class="attribute_tag no_collapse">未塌陷</div>
              </div>
            </div>

            <div style="display: flex; gap: 8px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #e9ecef">
              <el-button size="small" type="info" @click="view_cart_detail(cart_item)">详情</el-button>
              <el-button size="small" type="danger" @click="delete_model_card(cart_item.id)">移除</el-button>
            </div>
          </el-card>
        </div>

        <div v-if="cart_list.length > 0" style="margin-top: 20px; text-align: center">
          <el-alert :title="`购物车总计: ¥${get_cart_total()}`" type="info" style="margin-bottom: 15px"></el-alert>
          <el-button type="success" size="large" @click="create_order_from_cart">结算购物车</el-button>
        </div>

        <el-empty v-else description="购物车为空"></el-empty>
      </div>
    </div>

    <!-- 订单管理页面 -->
    <div v-if="current_tab === 'order'">
      <!-- 搜索区域 -->
      <el-form :inline="true" :model="order_search_form" style="margin-bottom: 20px">
        <el-form-item label="订单号">
          <el-input v-model="order_search_form.order_number" placeholder="搜索订单号" style="width: 200px"></el-input>
        </el-form-item>
        <el-form-item label="状态">
          <el-select v-model="order_search_form.status" placeholder="全部状态" style="width: 120px">
            <el-option label="全部状态" value=""></el-option>
            <el-option label="待支付" value="PAYING"></el-option>
            <el-option label="已支付" value="PAYED"></el-option>
            <el-option label="已发货" value="SHIPPED"></el-option>
            <el-option label="已取消" value="CANCELLED"></el-option>
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="find_list_model_order">搜索</el-button>
        </el-form-item>
      </el-form>

      <!-- 订单列表 -->
      <div>
        <h2>订单列表 /共 {{ order_total_count }} 个订单</h2>
        <div v-if="order_list.length > 0" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(450px, 1fr)); gap: 20px; margin-top: 15px">
          <el-card v-for="order in order_list" :key="order.id" shadow="hover" style="margin-bottom: 20px">
            <div class="order_header">
              <h4>订单号: {{ order.order_number }}</h4>
              <div :class="'order_status ' + order.status.toLowerCase()">{{ get_order_status_text(order.status) }}</div>
            </div>

            <div class="order_content">
              <div class="order_info">
                <div>用户ID: {{ order.user_id }}</div>
                <div>订单价格: ¥{{ order.price_order }}</div>
                <div>支付价格: ¥{{ order.price_pay }}</div>
                <div v-if="order.price_sub > 0">优惠: -¥{{ order.price_sub }}</div>
                <div>创建时间: {{ format_date(order.created_at) }}</div>
                <div v-if="order.pay_time">支付时间: {{ format_date(order.pay_time) }}</div>
              </div>

              <!-- 订单商品预览 -->
              <div v-if="order.tb_order_info && order.tb_order_info.length > 0" class="order_items_preview">
                <h5>商品列表:</h5>
                <div v-for="item in order.tb_order_info.slice(0, 3)" :key="item.id" class="order_item">{{ item.tb_model_product.title }} - ¥{{ item.price_one }} x {{ item.count }}</div>
                <div v-if="order.tb_order_info.length > 3" class="more_items">还有 {{ order.tb_order_info.length - 3 }} 个商品...</div>
              </div>
            </div>

            <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 15px; padding-top: 15px; border-top: 1px solid #e9ecef">
              <el-button size="small" type="info" @click="view_order_detail(order)">详情</el-button>
              <el-button size="small" type="warning" @click="update_order_status(order)" v-if="order.status !== 'PAYED' && order.status !== 'CANCELLED'">更新状态</el-button>
              <el-button size="small" type="danger" @click="delete_model_order(order.order_number)">删除</el-button>
            </div>
          </el-card>
        </div>
        <el-empty v-else description="暂无订单数据"></el-empty>
      </div>

      <!-- 订单分页 -->
      <el-pagination @current-change="go_to_order_page" :current-page="order_pagination.page_index" :page-size="order_pagination.page_size" :total="order_pagination.count_total" layout="total, prev, pager, next, jumper" style="text-align: center; margin-top: 20px"> </el-pagination>
    </div>

    <!-- 添加商品弹窗 -->
    <el-dialog title="添加3D模型" :visible.sync="show_add_product_modal" width="600px" :close-on-click-modal="false">
      <el-form :model="add_product_form" label-width="120px">
        <el-form-item label="模型标题">
          <el-input v-model="add_product_form.title" placeholder="请输入模型标题"></el-input>
        </el-form-item>
        <el-form-item label="模型描述">
          <el-input type="textarea" v-model="add_product_form.remark" placeholder="请输入模型描述" :rows="3"></el-input>
        </el-form-item>
        <el-form-item label="个人价格">
          <el-input-number v-model="add_product_form.price_personal" :min="0" placeholder="请输入个人价格"></el-input-number>
        </el-form-item>
        <el-form-item label="企业价格">
          <el-input-number v-model="add_product_form.price_company" :min="0" placeholder="请输入企业价格"></el-input-number>
        </el-form-item>
        <el-form-item label="企业扩展价格">
          <el-input-number v-model="add_product_form.price_extend" :min="0" placeholder="请输入企业扩展价格"></el-input-number>
        </el-form-item>
        <el-form-item label="是否公开">
          <el-radio-group v-model="add_product_form.is_public">
            <el-radio :label="true">公开</el-radio>
            <el-radio :label="false">私有</el-radio>
          </el-radio-group>
        </el-form-item>
        <el-form-item label="模型属性">
          <el-checkbox-group v-model="model_attributes">
            <el-checkbox label="is_skeleton">有骨骼</el-checkbox>
            <el-checkbox label="is_animation">有动画</el-checkbox>
            <el-checkbox label="is_business">商用</el-checkbox>
            <el-checkbox label="is_print">可打印</el-checkbox>
            <el-checkbox label="is_no_collapse">未塌陷</el-checkbox>
          </el-checkbox-group>
        </el-form-item>
        <el-form-item label="面片数">
          <el-select v-model="add_product_form.area_unit" placeholder="请选择面片数">
            <el-option label="5k以下" value="5k以下"></el-option>
            <el-option label="5k-10k" value="5k-10k"></el-option>
            <el-option label="10k-50k" value="10k-50k"></el-option>
            <el-option label="50k以上" value="50k以上"></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="布线方式">
          <el-select v-model="add_product_form.wiring" placeholder="请选择布线方式">
            <el-option label="三角形" value="三角形"></el-option>
            <el-option label="四边形" value="四边形"></el-option>
            <el-option label="混合" value="混合"></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="商品分类">
          <el-cascader
            v-model="add_product_form.kind_ids"
            :options="kind_tree_options"
            :props="cascader_props"
            placeholder="请选择分类"
            clearable
            multiple
            style="width: 100%"
          ></el-cascader>
        </el-form-item>

        <!-- 文件信息输入字段 -->
        <el-form-item label="模型图片">
          <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9">
            <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center">
              <el-input v-model="new_file_inputs.list_img.url" placeholder="输入文件URL" style="flex: 2"></el-input>
              <el-input v-model="new_file_inputs.list_img.name" placeholder="输入文件名" style="flex: 1"></el-input>
              <el-button type="success" size="small" @click="add_file_item('list_img', 'add')">添加</el-button>
            </div>
            <div v-for="(file, index) in add_product_form.list_img" :key="index" style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: white; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 5px">
              <span style="flex: 1; color: #333; font-weight: 500">{{ file.name }}</span>
              <span v-if="file.url" style="color: #666; font-size: 11px; margin-left: 8px; font-style: italic">({{ file.url }})</span>
              <el-button type="danger" size="mini" icon="el-icon-close" circle @click="remove_file('list_img', index, 'add')"></el-button>
            </div>
          </div>
        </el-form-item>

        <el-form-item label="模型文件">
          <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9">
            <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center">
              <el-input v-model="new_file_inputs.list_file.url" placeholder="输入文件URL" style="flex: 2"></el-input>
              <el-input v-model="new_file_inputs.list_file.name" placeholder="输入文件名" style="flex: 1"></el-input>
              <el-button type="success" size="small" @click="add_file_item('list_file', 'add')">添加</el-button>
            </div>
            <div v-for="(file, index) in add_product_form.list_file" :key="index" style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: white; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 5px">
              <span style="flex: 1; color: #333; font-weight: 500">{{ file.name }}</span>
              <span v-if="file.url" style="color: #666; font-size: 11px; margin-left: 8px; font-style: italic">({{ file.url }})</span>
              <el-button type="danger" size="mini" icon="el-icon-close" circle @click="remove_file('list_file', index, 'add')"></el-button>
            </div>
          </div>
        </el-form-item>

        <el-form-item label="模型视频">
          <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9">
            <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center">
              <el-input v-model="new_file_inputs.list_video.url" placeholder="输入文件URL" style="flex: 2"></el-input>
              <el-input v-model="new_file_inputs.list_video.name" placeholder="输入文件名" style="flex: 1"></el-input>
              <el-button type="success" size="small" @click="add_file_item('list_video', 'add')">添加</el-button>
            </div>
            <div v-for="(file, index) in add_product_form.list_video" :key="index" style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: white; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 5px">
              <span style="flex: 1; color: #333; font-weight: 500">{{ file.name }}</span>
              <span v-if="file.url" style="color: #666; font-size: 11px; margin-left: 8px; font-style: italic">({{ file.url }})</span>
              <el-button type="danger" size="mini" icon="el-icon-close" circle @click="remove_file('list_video', index, 'add')"></el-button>
            </div>
          </div>
        </el-form-item>

        <el-form-item label="扩展附件">
          <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9">
            <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center">
              <el-input v-model="new_file_inputs.list_extend.url" placeholder="输入文件URL" style="flex: 2"></el-input>
              <el-input v-model="new_file_inputs.list_extend.name" placeholder="输入文件名" style="flex: 1"></el-input>
              <el-button type="success" size="small" @click="add_file_item('list_extend', 'add')">添加</el-button>
            </div>
            <div v-for="(file, index) in add_product_form.list_extend" :key="index" style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: white; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 5px">
              <span style="flex: 1; color: #333; font-weight: 500">{{ file.name }}</span>
              <span v-if="file.url" style="color: #666; font-size: 11px; margin-left: 8px; font-style: italic">({{ file.url }})</span>
              <el-button type="danger" size="mini" icon="el-icon-close" circle @click="remove_file('list_extend', index, 'add')"></el-button>
            </div>
          </div>
        </el-form-item>

        <el-form-item label="贴图列表">
          <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9">
            <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center">
              <el-input v-model="new_file_inputs.list_texture.url" placeholder="输入贴图URL" style="flex: 2"></el-input>
              <el-input v-model="new_file_inputs.list_texture.name" placeholder="输入贴图名称" style="flex: 1"></el-input>
              <el-button type="success" size="small" @click="add_file_item('list_texture', 'add')">添加</el-button>
            </div>
            <div v-for="(file, index) in add_product_form.list_texture" :key="index" style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: white; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 5px">
              <span style="flex: 1; color: #333; font-weight: 500">{{ file.name }}</span>
              <span v-if="file.url" style="color: #666; font-size: 11px; margin-left: 8px; font-style: italic">({{ file.url }})</span>
              <el-button type="danger" size="mini" icon="el-icon-close" circle @click="remove_file('list_texture', index, 'add')"></el-button>
            </div>
          </div>
        </el-form-item>

        <el-form-item label="模型格式">
          <el-select v-model="add_product_form.model_format" placeholder="请选择模型格式">
            <el-option label=".stl" value=".stl"></el-option>
            <el-option label=".obj" value=".obj"></el-option>
            <el-option label=".fbx" value=".fbx"></el-option>
            <el-option label=".3ds" value=".3ds"></el-option>
            <el-option label=".dae" value=".dae"></el-option>
          </el-select>
        </el-form-item>

        <el-form-item label="审核状态">
          <el-radio-group v-model="add_product_form.is_check">
            <el-radio :label="true">已审核</el-radio>
            <el-radio :label="false">未审核</el-radio>
          </el-radio-group>
        </el-form-item>

        <el-form-item label="审核备注">
          <el-input v-model="add_product_form.is_check_remark" placeholder="请输入审核备注"></el-input>
        </el-form-item>

        <el-form-item label="删除状态">
          <el-radio-group v-model="add_product_form.is_deleted">
            <el-radio :label="false">未删除</el-radio>
            <el-radio :label="true">已删除</el-radio>
          </el-radio-group>
        </el-form-item>

        <el-form-item label="收藏数">
          <el-input-number v-model="add_product_form.count_collect" :min="0" placeholder="请输入收藏数"></el-input-number>
        </el-form-item>
      </el-form>

      <div slot="footer" class="dialog-footer">
        <el-button @click="close_add_product_modal">取消</el-button>
        <el-button type="primary" @click="create_model_product">保存</el-button>
      </div>
    </el-dialog>

    <!-- 编辑商品弹窗 -->
    <el-dialog title="编辑3D模型" :visible.sync="show_edit_product_modal" width="600px" :close-on-click-modal="false">
      <div style="max-height: 500px; overflow-y: auto; padding-right: 10px">
        <el-form :model="edit_product_form" label-width="120px">
          <el-form-item label="模型标题">
            <el-input v-model="edit_product_form.title" placeholder="请输入模型标题"></el-input>
          </el-form-item>
          <el-form-item label="模型描述">
            <el-input type="textarea" v-model="edit_product_form.remark" placeholder="请输入模型描述" :rows="3"></el-input>
          </el-form-item>
          <el-form-item label="个人价格">
            <el-input-number v-model="edit_product_form.price_personal" :min="0" placeholder="请输入个人价格"></el-input-number>
          </el-form-item>
          <el-form-item label="企业价格">
            <el-input-number v-model="edit_product_form.price_company" :min="0" placeholder="请输入企业价格"></el-input-number>
          </el-form-item>
          <el-form-item label="企业扩展价格">
            <el-input-number v-model="edit_product_form.price_extend" :min="0" placeholder="请输入企业扩展价格"></el-input-number>
          </el-form-item>
          <el-form-item label="是否公开">
            <el-radio-group v-model="edit_product_form.is_public">
              <el-radio :label="true">公开</el-radio>
              <el-radio :label="false">私有</el-radio>
            </el-radio-group>
          </el-form-item>
          <el-form-item label="模型属性">
            <el-checkbox-group v-model="edit_model_attributes">
              <el-checkbox label="is_skeleton">有骨骼</el-checkbox>
              <el-checkbox label="is_animation">有动画</el-checkbox>
              <el-checkbox label="is_business">商用</el-checkbox>
              <el-checkbox label="is_print">可打印</el-checkbox>
              <el-checkbox label="is_no_collapse">未塌陷</el-checkbox>
            </el-checkbox-group>
          </el-form-item>
          <el-form-item label="面片数">
            <el-select v-model="edit_product_form.area_unit" placeholder="请选择面片数">
              <el-option label="5k以下" value="5k以下"></el-option>
              <el-option label="5k-10k" value="5k-10k"></el-option>
              <el-option label="10k-50k" value="10k-50k"></el-option>
              <el-option label="50k以上" value="50k以上"></el-option>
            </el-select>
          </el-form-item>
          <el-form-item label="布线方式">
            <el-select v-model="edit_product_form.wiring" placeholder="请选择布线方式">
              <el-option label="三角形" value="三角形"></el-option>
              <el-option label="四边形" value="四边形"></el-option>
              <el-option label="混合" value="混合"></el-option>
            </el-select>
          </el-form-item>
          <el-form-item label="商品分类">
            <el-cascader
              v-model="edit_product_form.kind_ids"
              :options="kind_tree_options"
              :props="cascader_props"
              placeholder="请选择分类"
              clearable
              multiple
              style="width: 100%"
            ></el-cascader>
          </el-form-item>

          <!-- 文件信息输入字段 -->
          <el-form-item label="模型图片">
            <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9">
              <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center">
                <el-input v-model="new_file_inputs.list_img.url" placeholder="输入文件URL" style="flex: 2"></el-input>
                <el-input v-model="new_file_inputs.list_img.name" placeholder="输入文件名" style="flex: 1"></el-input>
                <el-button type="success" size="small" @click="add_file_item('list_img', 'edit')">添加</el-button>
              </div>
              <div v-for="(file, index) in edit_product_form.list_img" :key="index" style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: white; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 5px">
                <span style="flex: 1; color: #333; font-weight: 500">{{ file.name }}</span>
                <span v-if="file.url" style="color: #666; font-size: 11px; margin-left: 8px; font-style: italic">({{ file.url }})</span>
                <el-button type="danger" size="mini" icon="el-icon-close" circle @click="remove_file('list_img', index, 'edit')"></el-button>
              </div>
            </div>
          </el-form-item>

          <el-form-item label="模型文件">
            <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9">
              <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center">
                <el-input v-model="new_file_inputs.list_file.url" placeholder="输入文件URL" style="flex: 2"></el-input>
                <el-input v-model="new_file_inputs.list_file.name" placeholder="输入文件名" style="flex: 1"></el-input>
                <el-button type="success" size="small" @click="add_file_item('list_file', 'edit')">添加</el-button>
              </div>
              <div v-for="(file, index) in edit_product_form.list_file" :key="index" style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: white; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 5px">
                <span style="flex: 1; color: #333; font-weight: 500">{{ file.name }}</span>
                <span v-if="file.url" style="color: #666; font-size: 11px; margin-left: 8px; font-style: italic">({{ file.url }})</span>
                <el-button type="danger" size="mini" icon="el-icon-close" circle @click="remove_file('list_file', index, 'edit')"></el-button>
              </div>
            </div>
          </el-form-item>

          <el-form-item label="模型视频">
            <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9">
              <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center">
                <el-input v-model="new_file_inputs.list_video.url" placeholder="输入文件URL" style="flex: 2"></el-input>
                <el-input v-model="new_file_inputs.list_video.name" placeholder="输入文件名" style="flex: 1"></el-input>
                <el-button type="success" size="small" @click="add_file_item('list_video', 'edit')">添加</el-button>
              </div>
              <div v-for="(file, index) in edit_product_form.list_video" :key="index" style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: white; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 5px">
                <span style="flex: 1; color: #333; font-weight: 500">{{ file.name }}</span>
                <span v-if="file.url" style="color: #666; font-size: 11px; margin-left: 8px; font-style: italic">({{ file.url }})</span>
                <el-button type="danger" size="mini" icon="el-icon-close" circle @click="remove_file('list_video', index, 'edit')"></el-button>
              </div>
            </div>
          </el-form-item>

          <el-form-item label="扩展附件">
            <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9">
              <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center">
                <el-input v-model="new_file_inputs.list_extend.url" placeholder="输入文件URL" style="flex: 2"></el-input>
                <el-input v-model="new_file_inputs.list_extend.name" placeholder="输入文件名" style="flex: 1"></el-input>
                <el-button type="success" size="small" @click="add_file_item('list_extend', 'edit')">添加</el-button>
              </div>
              <div v-for="(file, index) in edit_product_form.list_extend" :key="index" style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: white; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 5px">
                <span style="flex: 1; color: #333; font-weight: 500">{{ file.name }}</span>
                <span v-if="file.url" style="color: #666; font-size: 11px; margin-left: 8px; font-style: italic">({{ file.url }})</span>
                <el-button type="danger" size="mini" icon="el-icon-close" circle @click="remove_file('list_extend', index, 'edit')"></el-button>
              </div>
            </div>
          </el-form-item>

          <el-form-item label="贴图列表">
            <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9">
              <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center">
                <el-input v-model="new_file_inputs.list_texture.url" placeholder="输入贴图URL" style="flex: 2"></el-input>
                <el-input v-model="new_file_inputs.list_texture.name" placeholder="输入贴图名称" style="flex: 1"></el-input>
                <el-button type="success" size="small" @click="add_file_item('list_texture', 'edit')">添加</el-button>
              </div>
              <div v-for="(file, index) in edit_product_form.list_texture" :key="index" style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: white; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 5px">
                <span style="flex: 1; color: #333; font-weight: 500">{{ file.name }}</span>
                <span v-if="file.url" style="color: #666; font-size: 11px; margin-left: 8px; font-style: italic">({{ file.url }})</span>
                <el-button type="danger" size="mini" icon="el-icon-close" circle @click="remove_file('list_texture', index, 'edit')"></el-button>
              </div>
            </div>
          </el-form-item>

          <el-form-item label="模型格式">
            <el-select v-model="edit_product_form.model_format" placeholder="请选择模型格式">
              <el-option label=".stl" value=".stl"></el-option>
              <el-option label=".obj" value=".obj"></el-option>
              <el-option label=".fbx" value=".fbx"></el-option>
              <el-option label=".3ds" value=".3ds"></el-option>
              <el-option label=".dae" value=".dae"></el-option>
            </el-select>
          </el-form-item>

          <el-form-item label="审核状态">
            <el-radio-group v-model="edit_product_form.is_check">
              <el-radio :label="true">已审核</el-radio>
              <el-radio :label="false">未审核</el-radio>
            </el-radio-group>
          </el-form-item>

          <el-form-item label="审核备注">
            <el-input v-model="edit_product_form.is_check_remark" placeholder="请输入审核备注"></el-input>
          </el-form-item>

          <el-form-item label="删除状态">
            <el-radio-group v-model="edit_product_form.is_deleted">
              <el-radio :label="false">未删除</el-radio>
              <el-radio :label="true">已删除</el-radio>
            </el-radio-group>
          </el-form-item>

          <el-form-item label="收藏数">
            <el-input-number v-model="edit_product_form.count_collect" :min="0" placeholder="请输入收藏数"></el-input-number>
          </el-form-item>
        </el-form>
      </div>

      <div slot="footer" class="dialog-footer">
        <el-button @click="close_edit_product_modal">取消</el-button>
        <el-button type="primary" @click="update_model_product">保存</el-button>
      </div>
    </el-dialog>

    <!-- 商品详情弹窗 -->
    <el-dialog title="3D模型详情" :visible.sync="show_product_detail_modal" width="800px" :close-on-click-modal="false">
      <div v-if="selected_product" style="max-height: 500px; overflow-y: auto; padding-right: 10px">
        <ul style="list-style: none; padding: 0; margin: 0">
          <!-- 基本信息 -->
          <li style="margin-bottom: 20px">
            <h4 style="color: #409eff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #409eff">基本信息</h4>
            <ul style="list-style: none; padding: 0; margin: 0; border: 1px solid #e4e7ed; border-radius: 4px; background: #fff">
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">ID</span>
                <span style="flex: 1; color: #303133">{{ selected_product.id }}</span>
              </li>
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">标题</span>
                <span style="flex: 1; color: #303133">{{ selected_product.title }}</span>
              </li>
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">描述</span>
                <span style="flex: 1; color: #303133">{{ selected_product.remark || '暂无描述' }}</span>
              </li>
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">个人价格</span>
                <span style="flex: 1; color: #303133">¥{{ selected_product.price_personal }}</span>
              </li>
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">企业价格</span>
                <span style="flex: 1; color: #303133">¥{{ selected_product.price_company }}</span>
              </li>
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">扩展价格</span>
                <span style="flex: 1; color: #303133">¥{{ selected_product.price_extend }}</span>
              </li>
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">状态</span>
                <span style="flex: 1">
                  <el-tag :type="selected_product.is_public ? 'success' : 'info'"> {{ selected_product.is_public ? '公开' : '私有' }} </el-tag>
                </span>
              </li>
              <li style="display: flex; padding: 12px 15px; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">审核状态</span>
                <span style="flex: 1">
                  <el-tag :type="selected_product.is_check ? 'success' : 'warning'"> {{ selected_product.is_check ? '已审核' : '未审核' }} </el-tag>
                </span>
              </li>
            </ul>
          </li>

          <!-- 模型属性 -->
          <li style="margin-bottom: 20px">
            <h4 style="color: #67c23a; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #67c23a">模型属性</h4>
            <ul style="list-style: none; padding: 0; margin: 0; border: 1px solid #e4e7ed; border-radius: 4px; background: #fff">
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">面片数</span>
                <span style="flex: 1; color: #303133">{{ selected_product.area_unit }}</span>
              </li>
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">布线</span>
                <span style="flex: 1; color: #303133">{{ selected_product.wiring }}</span>
              </li>
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">有骨骼</span>
                <span style="flex: 1">
                  <el-tag :type="selected_product.is_skeleton ? 'success' : 'info'"> {{ selected_product.is_skeleton ? '是' : '否' }} </el-tag>
                </span>
              </li>
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">有动画</span>
                <span style="flex: 1">
                  <el-tag :type="selected_product.is_animation ? 'success' : 'info'"> {{ selected_product.is_animation ? '是' : '否' }} </el-tag>
                </span>
              </li>
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">商用</span>
                <span style="flex: 1">
                  <el-tag :type="selected_product.is_business ? 'success' : 'info'"> {{ selected_product.is_business ? '是' : '否' }} </el-tag>
                </span>
              </li>
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">可打印</span>
                <span style="flex: 1">
                  <el-tag :type="selected_product.is_print ? 'success' : 'info'"> {{ selected_product.is_print ? '是' : '否' }} </el-tag>
                </span>
              </li>
              <li style="display: flex; padding: 12px 15px; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">未塌陷</span>
                <span style="flex: 1">
                  <el-tag :type="selected_product.is_no_collapse ? 'success' : 'info'"> {{ selected_product.is_no_collapse ? '是' : '否' }} </el-tag>
                </span>
              </li>
            </ul>
          </li>

          <!-- 分类信息 -->
          <li v-if="selected_product.tb_model_kind && selected_product.tb_model_kind.length > 0" style="margin-bottom: 20px">
            <h4 style="color: #9c27b0; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #9c27b0">分类信息</h4>
            <ul style="list-style: none; padding: 0; margin: 0; border: 1px solid #e4e7ed; border-radius: 4px; background: #fff">
              <li style="display: flex; padding: 12px 15px; align-items: flex-start">
                <span style="width: 100px; color: #909399; font-weight: 500; margin-top: 5px">商品分类</span>
                <div style="flex: 1">
                  <el-tag v-for="kind in selected_product.tb_model_kind" :key="kind.id" type="info" style="margin: 3px">
                    {{ kind.name }}
                  </el-tag>
                </div>
              </li>
            </ul>
          </li>

          <!-- 统计信息 -->
          <li style="margin-bottom: 20px">
            <h4 style="color: #e6a23c; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #e6a23c">统计信息</h4>
            <ul style="list-style: none; padding: 0; margin: 0; border: 1px solid #e4e7ed; border-radius: 4px; background: #fff">
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">收藏数</span>
                <span style="flex: 1; color: #409eff; font-size: 18px; font-weight: bold">{{ selected_product.count_collect }}</span>
              </li>
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">下载数</span>
                <span style="flex: 1; color: #67c23a; font-size: 18px; font-weight: bold">{{ selected_product.count_download }}</span>
              </li>
              <li style="display: flex; padding: 12px 15px; align-items: center">
                <span style="width: 100px; color: #909399; font-weight: 500">点赞数</span>
                <span style="flex: 1; color: #e6a23c; font-size: 18px; font-weight: bold">{{ selected_product.count_like }}</span>
              </li>
            </ul>
          </li>

          <!-- 文件信息 -->
          <li style="margin-bottom: 20px">
            <h4 style="color: #f56c6c; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #f56c6c">文件信息</h4>
            <ul style="list-style: none; padding: 0; margin: 0; border: 1px solid #e4e7ed; border-radius: 4px; background: #fff">
              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: flex-start">
                <span style="width: 100px; color: #909399; font-weight: 500; margin-top: 5px">模型图片</span>
                <div style="flex: 1">
                  <div v-if="selected_product.list_img && selected_product.list_img.length > 0">
                    <el-tag v-for="(file, index) in selected_product.list_img" :key="index" style="margin: 5px">
                      {{ file.name }}
                      <span v-if="file.url" style="color: #999; font-size: 12px">({{ file.url }})</span>
                    </el-tag>
                  </div>
                  <el-empty v-else description="暂无图片"></el-empty>
                </div>
              </li>

              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: flex-start">
                <span style="width: 100px; color: #909399; font-weight: 500; margin-top: 5px">模型文件</span>
                <div style="flex: 1">
                  <div v-if="selected_product.list_file && selected_product.list_file.length > 0">
                    <el-tag v-for="(file, index) in selected_product.list_file" :key="index" style="margin: 5px">
                      {{ file.name }}
                      <span v-if="file.url" style="color: #999; font-size: 12px">({{ file.url }})</span>
                    </el-tag>
                  </div>
                  <el-empty v-else description="暂无文件"></el-empty>
                </div>
              </li>

              <li style="display: flex; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; align-items: flex-start">
                <span style="width: 100px; color: #909399; font-weight: 500; margin-top: 5px">模型视频</span>
                <div style="flex: 1">
                  <div v-if="selected_product.list_video && selected_product.list_video.length > 0">
                    <el-tag v-for="(file, index) in selected_product.list_video" :key="index" style="margin: 5px">
                      {{ file.name }}
                      <span v-if="file.url" style="color: #999; font-size: 12px">({{ file.url }})</span>
                    </el-tag>
                  </div>
                  <el-empty v-else description="暂无视频"></el-empty>
                </div>
              </li>

              <li style="display: flex; padding: 12px 15px; align-items: flex-start">
                <span style="width: 100px; color: #909399; font-weight: 500; margin-top: 5px">扩展附件</span>
                <div style="flex: 1">
                  <div v-if="selected_product.list_extend && selected_product.list_extend.length > 0">
                    <el-tag v-for="(file, index) in selected_product.list_extend" :key="index" style="margin: 5px">
                      {{ file.name }}
                      <span v-if="file.url" style="color: #999; font-size: 12px">({{ file.url }})</span>
                    </el-tag>
                  </div>
                  <el-empty v-else description="暂无附件"></el-empty>
                </div>
              </li>
            </ul>
          </li>
        </ul>
      </div>

      <div slot="footer" class="dialog-footer">
        <el-button @click="close_product_detail_modal">关闭</el-button>
      </div>
    </el-dialog>

    <!-- 购物车详情弹窗 -->
    <el-dialog title="购物车详情" :visible.sync="show_cart_detail_modal" width="500px" :close-on-click-modal="false">
      <div v-if="selected_cart_item">
        <el-form label-width="100px" :model="selected_cart_item">
          <el-form-item label="购物车ID">
            <span>{{ selected_cart_item.id }}</span>
          </el-form-item>
          <el-form-item label="用户ID">
            <span>{{ selected_cart_item.user_id }}</span>
          </el-form-item>
          <el-form-item label="商品标题">
            <span>{{ selected_cart_item.product.title }}</span>
          </el-form-item>
          <el-form-item label="商品价格">
            <span>¥{{ selected_cart_item.price }}</span>
          </el-form-item>
          <el-form-item label="价格类型">
            <el-tag type="primary">{{ get_price_type_text(selected_cart_item.price_type) }}</el-tag>
          </el-form-item>
          <el-form-item label="添加时间">
            <span>{{ format_date(selected_cart_item.created_at) }}</span>
          </el-form-item>
        </el-form>
      </div>

      <div slot="footer" class="dialog-footer">
        <el-button @click="close_cart_detail_modal">关闭</el-button>
      </div>
    </el-dialog>

    <!-- 订单详情弹窗 -->
    <el-dialog title="订单详情" :visible.sync="show_order_detail_modal" width="800px" :close-on-click-modal="false">
      <div v-if="selected_order">
        <el-tabs type="border-card">
          <el-tab-pane label="订单信息">
            <el-descriptions :column="2" border>
              <el-descriptions-item label="订单号">{{ selected_order.order_number }}</el-descriptions-item>
              <el-descriptions-item label="用户ID">{{ selected_order.user_id }}</el-descriptions-item>
              <el-descriptions-item label="订单价格">¥{{ selected_order.price_order }}</el-descriptions-item>
              <el-descriptions-item label="支付价格">¥{{ selected_order.price_pay }}</el-descriptions-item>
              <el-descriptions-item v-if="selected_order.price_sub > 0" label="优惠金额">-¥{{ selected_order.price_sub }}</el-descriptions-item>
              <el-descriptions-item label="状态">
                <el-tag :type="get_order_status_type(selected_order.status)"> {{ get_order_status_text(selected_order.status) }} </el-tag>
              </el-descriptions-item>
              <el-descriptions-item label="创建时间">{{ format_date(selected_order.created_at) }}</el-descriptions-item>
              <el-descriptions-item v-if="selected_order.pay_time" label="支付时间">{{ format_date(selected_order.pay_time) }}</el-descriptions-item>
            </el-descriptions>
          </el-tab-pane>

          <el-tab-pane label="订单商品">
            <div v-if="selected_order.tb_order_info && selected_order.tb_order_info.length > 0">
              <el-card v-for="item in selected_order.tb_order_info" :key="item.id" shadow="hover" style="margin-bottom: 15px">
                <div style="display: flex; justify-content: space-between; align-items: flex-start">
                  <div style="flex: 1">
                    <h4 style="margin: 0 0 10px 0; color: #333">{{ item.tb_model_product.title }}</h4>
                    <p style="margin: 0 0 10px 0; color: #666; font-size: 14px">{{ item.tb_model_product.remark || '暂无描述' }}</p>
                    <div style="display: flex; gap: 5px; flex-wrap: wrap">
                      <el-tag v-if="item.tb_model_product.is_skeleton" type="warning" size="small">有骨骼</el-tag>
                      <el-tag v-if="item.tb_model_product.is_animation" type="info" size="small">有动画</el-tag>
                      <el-tag v-if="item.tb_model_product.is_business" type="danger" size="small">商用</el-tag>
                      <el-tag v-if="item.tb_model_product.is_print" type="success" size="small">可打印</el-tag>
                      <el-tag v-if="item.tb_model_product.is_no_collapse" type="primary" size="small">未塌陷</el-tag>
                    </div>
                  </div>
                  <div style="text-align: right; min-width: 120px">
                    <div style="margin: 5px 0; font-size: 14px; color: #666">单价: ¥{{ item.price_one }}</div>
                    <div style="margin: 5px 0; font-size: 14px; color: #666">数量: {{ item.count }}</div>
                    <div style="margin: 10px 0 0 0; padding-top: 10px; border-top: 1px solid #eee; font-weight: bold; color: #e6a23c; font-size: 16px">小计: ¥{{ item.price_one * item.count }}</div>
                  </div>
                </div>
              </el-card>
            </div>
            <el-empty v-else description="暂无商品信息"></el-empty>
          </el-tab-pane>
        </el-tabs>
      </div>

      <div slot="footer" class="dialog-footer">
        <el-button @click="close_order_detail_modal">关闭</el-button>
      </div>
    </el-dialog>

    <!-- 更新订单状态弹窗 -->
    <el-dialog title="更新订单状态" :visible.sync="show_update_status_modal" width="500px" :close-on-click-modal="false">
      <div v-if="selected_order">
        <el-descriptions :column="1" border style="margin-bottom: 20px">
          <el-descriptions-item label="订单号">{{ selected_order.order_number }}</el-descriptions-item>
          <el-descriptions-item label="当前状态">
            <el-tag :type="get_order_status_type(selected_order.status)"> {{ get_order_status_text(selected_order.status) }} </el-tag>
          </el-descriptions-item>
        </el-descriptions>

        <el-form :model="{ status: new_order_status }" label-width="80px">
          <el-form-item label="新状态">
            <el-select v-model="new_order_status" placeholder="请选择新状态" style="width: 100%">
              <el-option label="待支付" value="PAYING"></el-option>
              <el-option label="已支付" value="PAYED"></el-option>
              <el-option label="已发货" value="SHIPPED"></el-option>
              <el-option label="已取消" value="CANCELLED"></el-option>
            </el-select>
          </el-form-item>
        </el-form>
      </div>

      <div slot="footer" class="dialog-footer">
        <el-button @click="close_update_status_modal">取消</el-button>
        <el-button type="primary" @click="confirm_update_order_status">确认更新</el-button>
      </div>
    </el-dialog>
  </main>

  <script>
    axios.defaults.headers.common['token'] = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjE1MTYwMzE1MTEwIiwicGhvbmUiOiIxNTE2MDMxNTExMCIsImlkIjoxLCJyb2xlSWRzIjpbXSwiaWF0IjoxNzU2ODEzODM5LCJleHAiOjI2MjA3Mjc0MzksImlhdF90aW1lIjoiMjAyNS0wOS0wMiAxOTo1MDozOSIsImV4cF90aW1lIjoiMjA1My0wMS0xNyAxOTo1MDozOSJ9.ms6AOMGE_UYaAS3ilcdEdK6R2FGKGUVKVDBzAB_XP40'
    axios.defaults.baseURL = 'http://127.0.0.1:3000'


    

    Vue.prototype.axios = axios
    Vue.prototype.dayjs = dayjs
    Vue.prototype.window = window
    Vue.prototype.document = window.document

    window.app = new Vue({
      el: '#app',
      data: {
        current_tab: 'product',
        user_id: 1,

        // 商品相关数据
        product_search_form: {
          title: '',
          remark: '', // 备注字段，必填
          is_public: true, // 默认选择公开状态
          is_deleted: false, // 默认选择未删除
          is_check: true, // 默认选择已审核
          // 模糊字段
          is_business: null, // 默认选择非商用
          is_skeleton: null, // 默认选择无骨骼
          is_animation: null, // 默认选择无动画
          is_print: null, // 默认选择不可打印
          is_no_collapse: null, // 默认选择未塌陷
          wiring: null, // 默认选择三角形
          kind_ids: [], // 分类筛选
          page_index: 1,
          page_size: 10,
          order_by: 'created_at',
          order_type: 'desc',
        },
        add_product_form: {
          title: '',
          remark: '',
          price_personal: 0,
          price_company: 0,
          price_extend: 0,
          is_public: true,
          is_skeleton: false,
          is_animation: false,
          is_business: false,
          is_print: false,
          is_no_collapse: false,
          area_unit: '5k以下',
          wiring: '三角形',
          kind_ids: [], // 分类选择
          list_img: [],
          list_file: [],
          list_video: [],
          list_extend: [],
          list_texture: [],
          model_format: '.stl',
          is_check: false,
          is_check_remark: '',
          is_deleted: false,
          count_collect: 0,
        },
        edit_product_form: {
          id: null,
          title: '',
          remark: '',
          price_personal: 0,
          price_company: 0,
          price_extend: 0,
          is_public: true,
          is_skeleton: false,
          is_animation: false,
          is_business: false,
          is_print: false,
          is_no_collapse: false,
          area_unit: '5k以下',
          wiring: '三角形',
          kind_ids: [], // 分类选择
          list_img: [],
          list_file: [],
          list_video: [],
          list_extend: [],
          list_texture: [],
          model_format: '.stl',
          is_check: false,
          is_check_remark: '',
          is_deleted: false,
          count_collect: 0,
        },
        product_list: [],
        product_pagination: {
          page_index: 1,
          page_size: 10,
          count_total: 0,
          page_total: 0,
        },
        product_total_count: 0,

        // 购物车相关数据
        cart_user_id: 1,
        cart_list: [],
        cart_total_count: 0,

        // 订单相关数据
        order_search_form: {
          user_id: null,
          order_number: '',
          status: '',
          page_index: 1,
          page_size: 10,
          order_by: 'created_at',
          order_type: 'desc',
        },
        order_list: [],
        order_pagination: {
          page_index: 1,
          page_size: 10,
          count_total: 0,
          page_total: 0,
        },
        order_total_count: 0,

        // 弹窗控制
        show_add_product_modal: false,
        show_edit_product_modal: false,
        show_product_detail_modal: false,
        show_cart_detail_modal: false,
        show_order_detail_modal: false,
        show_update_status_modal: false,
        selected_product: null,
        selected_cart_item: null,
        selected_order: null,
        new_order_status: 'PAYING',

        // 价格类型选择
        cart_price_types: {},

        // 文件输入临时变量 - 每个文件类型独立
        new_file_inputs: {
          list_img: { url: '', name: '' },
          list_file: { url: '', name: '' },
          list_video: { url: '', name: '' },
          list_extend: { url: '', name: '' },
          list_texture: { url: '', name: '' },
        },

        // 模型属性选择
        model_attributes: [],

        // 文件折叠面板
        activeFileCollapse: [],

        // 编辑模型属性选择
        edit_model_attributes: [],

        // 分类相关数据
        kind_tree_options: [],
        cascader_props: {
          value: 'id',
          label: 'name',
          children: 'children',
          multiple: true,
          checkStrictly: true
        },
      },

      methods: {
        // 显示消息
        show_message(text, type = 'success') {
          this.$message({
            message: text,
            type: type,
          })
        },

        // 获取分类树
        async get_kind_tree() {
          try {
            const response = await this.axios.get('/get_kind_tree')
            if (response.data.code === 200) {
              this.kind_tree_options = response.data.result
            } else {
              this.show_message('获取分类树失败: ' + response.data.msg, 'error')
            }
          } catch (error) {
            this.show_message('获取分类树出错: ' + error.message, 'error')
          }
        },

        // 格式化日期
        format_date(date) {
          if (!date) return ''
          return this.dayjs(date).format('YYYY-MM-DD HH:mm:ss')
        },

        // 获取订单状态文本
        get_order_status_text(status) {
          const status_map = {
            PAYING: '待支付',
            PAYED: '已支付',
            SHIPPED: '已发货',
            CANCELLED: '已取消',
          }
          return status_map[status] || status
        },

        // 获取订单状态类型（用于el-tag颜色）
        get_order_status_type(status) {
          const type_map = {
            PAYING: 'warning',
            PAYED: 'success',
            SHIPPED: 'primary',
            CANCELLED: 'danger',
          }
          return type_map[status] || 'info'
        },

        // 获取价格类型文本
        get_price_type_text(price_type) {
          const type_map = {
            price_personal: '个人价格',
            price_company: '企业价格',
            price_extend: '扩展价格',
          }
          return type_map[price_type] || price_type
        },

        // 计算购物车总价
        get_cart_total() {
          return this.cart_list.reduce((total, item) => total + item.price, 0)
        },

        // 获取商品的价格类型选择
        get_cart_price_type(product) {
          if (!this.cart_price_types[product.id]) {
            this.$set(this.cart_price_types, product.id, 'price_personal')
          }
          return this.cart_price_types[product.id]
        },

        // 更新商品的价格类型选择
        update_cart_price_type(product, price_type) {
          this.$set(this.cart_price_types, product.id, price_type)
        },

        // 根据价格类型获取价格
        get_price_by_type(product, price_type) {
          switch (price_type) {
            case 'price_personal':
              return product.price_personal
            case 'price_company':
              return product.price_company
            case 'price_extend':
              return product.price_extend
            default:
              return product.price_personal
          }
        },

        // ========== 文件处理方法 ==========
        // 添加文件项
        add_file_item(field_name, form_type) {
          const input_data = this.new_file_inputs[field_name]

          if (!input_data.name.trim()) {
            this.show_message('请输入文件名', 'error')
            return
          }

          const target_form = form_type === 'add' ? this.add_product_form : this.edit_product_form

          // 创建文件对象
          const fileObj = {
            url: input_data.url.trim(),
            name: input_data.name.trim(),
          }

          // 添加到对应的数组中
          target_form[field_name].push(fileObj)

          // 清空对应文件类型的输入框
          input_data.url = ''
          input_data.name = ''

          this.show_message(`已添加文件: ${fileObj.name}`)
        },

        // 删除文件
        remove_file(field_name, index, form_type) {
          const target_form = form_type === 'add' ? this.add_product_form : this.edit_product_form
          target_form[field_name].splice(index, 1)
          this.show_message('文件已删除')
        },

        // 标准化文件数组格式
        normalize_file_array(file_array) {
          if (!file_array || !Array.isArray(file_array)) {
            return []
          }

          return file_array.map((file) => {
            // 如果已经是对象格式 {url: "", name: ""}，直接返回
            if (typeof file === 'object' && file.name) {
              return {
                url: file.url || '',
                name: file.name,
              }
            }
            // 如果是字符串格式，转换为对象格式
            else if (typeof file === 'string') {
              return {
                url: '',
                name: file,
              }
            }
            // 其他情况返回默认格式
            else {
              return {
                url: '',
                name: String(file),
              }
            }
          })
        },

        // 获取商品的第一张图片
        get_first_image(product) {
          if (!product.list_img || !Array.isArray(product.list_img) || product.list_img.length === 0) {
            return null
          }

          const firstImage = product.list_img[0]
          if (typeof firstImage === 'object' && firstImage.url) {
            return firstImage.url
          } else if (typeof firstImage === 'string' && firstImage.trim()) {
            return firstImage
          }

          return null
        },

        // 处理图片加载错误
        handle_image_error(event) {
          console.log('图片加载失败:', event.target.src)
          // 可以设置默认图片或隐藏图片
          event.target.style.display = 'none'
        },

        // ========== 商品管理方法 ==========
        // 搜索商品
        async find_list_model_product() {
          try {
            const searchData = { ...this.product_search_form }

            console.log(`111---searchData:`, searchData)

            const response = await this.axios.post('/find_list_model_product', searchData)
            if (response.data.code === 200) {
              this.product_list = response.data.result.list
              this.product_pagination = response.data.result.pagination
              this.product_total_count = response.data.result.pagination.count_total
              this.show_message('搜索完成')
            } else {
              this.show_message('搜索失败: ' + response.data.msg, 'error')
            }
          } catch (error) {
            this.show_message('搜索出错: ' + error.message, 'error')
          }
        },

        // 重置搜索表单
        reset_search_form() {
          this.product_search_form = {
            title: '',
            remark: '搜索备注',
            is_public: true,
            is_deleted: false,
            is_check: true,
            // 
            is_business: false,
            is_skeleton: false,
            is_animation: false,
            is_print: false,
            is_no_collapse: true,
            wiring: '三角形',
            kind_ids: [], // 重置分类筛选
            page_index: 1,
            page_size: 10,
            order_by: 'created_at',
            order_type: 'desc',
          }
          this.show_message('搜索条件已重置')
        },

        // 打开添加商品弹窗
        open_add_product_modal() {
          this.show_add_product_modal = true
        },

        // 关闭添加商品弹窗
        close_add_product_modal() {
          this.show_add_product_modal = false
          this.reset_add_product_form()
        },

        // 重置添加商品表单
        reset_add_product_form() {
          this.add_product_form = {
            title: '',
            remark: '',
            price_personal: 0,
            price_company: 0,
            price_extend: 0,
            is_public: true,
            is_skeleton: false,
            is_animation: false,
            is_business: false,
            is_print: false,
            is_no_collapse: false,
            area_unit: '5k以下',
            wiring: '三角形',
            kind_ids: [], // 重置分类选择
            list_img: [],
            list_file: [],
            list_video: [],
            list_extend: [],
            list_texture: [],
            model_format: '.stl',
            is_check: false,
            is_check_remark: '',
            is_deleted: false,
            count_collect: 0,
          }
          // 清空所有文件类型的输入变量
          this.new_file_inputs = {
            list_img: { url: '', name: '' },
            list_file: { url: '', name: '' },
            list_video: { url: '', name: '' },
            list_extend: { url: '', name: '' },
            list_texture: { url: '', name: '' },
          }
          // 清空模型属性选择
          this.model_attributes = []
        },

        // 添加商品
        async create_model_product() {
          if (!this.add_product_form.title.trim()) {
            this.show_message('请输入模型标题', 'error')
            return
          }

          try {
            // 处理模型属性
            this.add_product_form.is_skeleton = this.model_attributes.includes('is_skeleton')
            this.add_product_form.is_animation = this.model_attributes.includes('is_animation')
            this.add_product_form.is_business = this.model_attributes.includes('is_business')
            this.add_product_form.is_print = this.model_attributes.includes('is_print')
            this.add_product_form.is_no_collapse = this.model_attributes.includes('is_no_collapse')

            // 准备提交数据，保持文件对象格式 {url: "", name: "文件名"}
            const submit_data = {
              ...this.add_product_form,
              list_img: this.add_product_form.list_img,
              list_file: this.add_product_form.list_file,
              list_video: this.add_product_form.list_video,
              list_extend: this.add_product_form.list_extend,
              list_texture: this.add_product_form.list_texture,
            }

            const response = await this.axios.post('/save_model_product', submit_data)
            if (response.data.code === 200) {
              this.show_message('添加成功')
              this.close_add_product_modal()
              this.find_list_model_product()
            } else {
              this.show_message('添加失败: ' + response.data.msg, 'error')
            }
          } catch (error) {
            this.show_message('添加出错: ' + error.message, 'error')
          }
        },

        // 编辑商品
        edit_product(product) {
          this.edit_product_form = {
            id: product.id,
            title: product.title,
            remark: product.remark || '',
            price_personal: product.price_personal || 0,
            price_company: product.price_company || 0,
            price_extend: product.price_extend || 0,
            is_public: product.is_public,
            is_skeleton: product.is_skeleton || false,
            is_animation: product.is_animation || false,
            is_business: product.is_business || false,
            is_print: product.is_print || false,
            is_no_collapse: product.is_no_collapse || false,
            area_unit: product.area_unit || '5k以下',
            wiring: product.wiring || '三角形',
            kind_ids: product.tb_model_kind ? product.tb_model_kind.map(kind => kind.id) : [], // 设置分类
            list_img: this.normalize_file_array(product.list_img),
            list_file: this.normalize_file_array(product.list_file),
            list_video: this.normalize_file_array(product.list_video),
            list_extend: this.normalize_file_array(product.list_extend),
            list_texture: this.normalize_file_array(product.list_texture),
            model_format: product.model_format || '.stl',
            is_check: product.is_check || false,
            is_check_remark: product.is_check_remark || '',
            is_deleted: product.is_deleted || false,
            count_collect: product.count_collect || 0,
          }

          // 设置编辑模型属性选择
          this.edit_model_attributes = []
          if (product.is_skeleton) this.edit_model_attributes.push('is_skeleton')
          if (product.is_animation) this.edit_model_attributes.push('is_animation')
          if (product.is_business) this.edit_model_attributes.push('is_business')
          if (product.is_print) this.edit_model_attributes.push('is_print')
          if (product.is_no_collapse) this.edit_model_attributes.push('is_no_collapse')

          this.show_edit_product_modal = true
        },

        // 保存编辑
        async update_model_product() {
          try {
            // 处理模型属性
            this.edit_product_form.is_skeleton = this.edit_model_attributes.includes('is_skeleton')
            this.edit_product_form.is_animation = this.edit_model_attributes.includes('is_animation')
            this.edit_product_form.is_business = this.edit_model_attributes.includes('is_business')
            this.edit_product_form.is_print = this.edit_model_attributes.includes('is_print')
            this.edit_product_form.is_no_collapse = this.edit_model_attributes.includes('is_no_collapse')

            // 准备提交数据，保持文件对象格式 {url: "", name: "文件名"}
            const submit_data = {
              ...this.edit_product_form,
              list_img: this.edit_product_form.list_img,
              list_file: this.edit_product_form.list_file,
              list_video: this.edit_product_form.list_video,
              list_extend: this.edit_product_form.list_extend,
              list_texture: this.edit_product_form.list_texture,
            }

            const response = await this.axios.post('/save_model_product', submit_data)
            if (response.data.code === 200) {
              this.show_message('更新成功')
              this.close_edit_product_modal()
              this.find_list_model_product()
            } else {
              this.show_message('更新失败: ' + response.data.msg, 'error')
            }
          } catch (error) {
            this.show_message('更新出错: ' + error.message, 'error')
          }
        },

        // 关闭编辑弹窗
        close_edit_product_modal() {
          this.show_edit_product_modal = false
          this.edit_product_form = {
            id: null,
            title: '',
            remark: '',
            price_personal: 0,
            price_company: 0,
            price_extend: 0,
            is_public: true,
            is_skeleton: null,
            is_animation: null,
            is_business: null,
            is_print: null,
            is_no_collapse: null,
            area_unit: '',
            wiring: '',
            kind_ids: [], // 重置分类选择
            list_img: [],
            list_file: [],
            list_video: [],
            list_extend: [],
            list_texture: [],
            model_format: '.stl',
            is_check: false,
            is_check_remark: '',
            is_deleted: false,
            count_collect: 0,
          }
          // 清空所有文件类型的输入变量
          this.new_file_inputs = {
            list_img: { url: '', name: '' },
            list_file: { url: '', name: '' },
            list_video: { url: '', name: '' },
            list_extend: { url: '', name: '' },
            list_texture: { url: '', name: '' },
          }
          // 清空编辑模型属性选择
          this.edit_model_attributes = []
        },

        // 查看商品详情
        view_product_detail(product) {
          this.selected_product = product
          this.show_product_detail_modal = true
        },

        // 关闭商品详情弹窗
        close_product_detail_modal() {
          this.show_product_detail_modal = false
          this.selected_product = null
        },

        // 删除商品
        async delete_model_product(id) {
          if (!confirm('确定要删除这个商品吗？')) {
            return
          }

          try {
            const response = await this.axios.get(`/delete_model_product?id=${id}`)
            if (response.data.code === 200) {
              this.show_message('删除成功')
              this.find_list_model_product()
            } else {
              this.show_message('删除失败: ' + response.data.msg, 'error')
            }
          } catch (error) {
            this.show_message('删除出错: ' + error.message, 'error')
          }
        },

        // 加入购物车
        async add_to_cart(product) {
          try {
            const price_type = this.get_cart_price_type(product)
            const price = this.get_price_by_type(product, price_type)

            const response = await this.axios.post('/save_model_card', {
              user_id: this.user_id,
              product_id: product.id,
              price: price,
              price_type: price_type,
            })
            if (response.data.code === 200) {
              this.show_message(`已加入购物车 (${this.get_price_type_text(price_type)})`)
            } else {
              this.show_message('加入购物车失败: ' + response.data.msg, 'error')
            }
          } catch (error) {
            this.show_message('加入购物车出错: ' + error.message, 'error')
          }
        },

        // 商品分页跳转
        go_to_product_page(page) {
          this.product_search_form.page_index = page
          this.find_list_model_product()
        },

        // ========== 购物车管理方法 ==========
        // 查看购物车
        async find_list_model_card() {
          if (!this.cart_user_id) {
            this.show_message('请输入用户ID', 'error')
            return
          }

          try {
            const response = await this.axios.post('/find_list_model_card', {
              user_id: this.cart_user_id,
              page_index: 1,
              page_size: 100,
              order_by: 'created_at',
              order_type: 'desc',
            })
            if (response.data.code === 200) {
              this.cart_list = response.data.result.list
              this.cart_total_count = response.data.result.pagination.count_total
              this.show_message('购物车加载完成')
            } else {
              this.show_message('加载购物车失败: ' + response.data.msg, 'error')
            }
          } catch (error) {
            this.show_message('加载购物车出错: ' + error.message, 'error')
          }
        },

        // 查看购物车详情
        view_cart_detail(cart_item) {
          this.selected_cart_item = cart_item
          this.show_cart_detail_modal = true
        },

        // 关闭购物车详情弹窗
        close_cart_detail_modal() {
          this.show_cart_detail_modal = false
          this.selected_cart_item = null
        },

        // 删除购物车商品
        async delete_model_card(id) {
          if (!confirm('确定要从购物车中移除这个商品吗？')) {
            return
          }

          try {
            const response = await this.axios.get(`/delete_model_card?id=${id}`)
            if (response.data.code === 200) {
              this.show_message('移除成功')
              this.find_list_model_card()
            } else {
              this.show_message('移除失败: ' + response.data.msg, 'error')
            }
          } catch (error) {
            this.show_message('移除出错: ' + error.message, 'error')
          }
        },

        // 清空购物车
        async clear_model_card() {
          if (!confirm('确定要清空购物车吗？')) {
            return
          }

          try {
            const response = await this.axios.get(`/clear_model_card?user_id=${this.cart_user_id}`)
            if (response.data.code === 200) {
              this.show_message('购物车已清空')
              this.find_list_model_card()
            } else {
              this.show_message('清空失败: ' + response.data.msg, 'error')
            }
          } catch (error) {
            this.show_message('清空出错: ' + error.message, 'error')
          }
        },

        // 从购物车创建订单
        async create_order_from_cart() {
          if (!this.cart_user_id) {
            this.show_message('请输入用户ID', 'error')
            return
          }

          try {
            const response = await this.axios.post('/create_order_from_cart', {
              user_id: this.cart_user_id,
              price_sub: 0,
            })
            if (response.data.code === 200) {
              this.show_message('订单创建成功')
              this.find_list_model_card()
              this.current_tab = 'order'
              this.find_list_model_order()
            } else {
              this.show_message('创建订单失败: ' + response.data.msg, 'error')
            }
          } catch (error) {
            this.show_message('创建订单出错: ' + error.message, 'error')
          }
        },

        // ========== 订单管理方法 ==========
        // 搜索订单
        async find_list_model_order() {
          try {
            const response = await this.axios.post('/find_list_model_order', this.order_search_form)
            if (response.data.code === 200) {
              this.order_list = response.data.result.list
              this.order_pagination = response.data.result.pagination
              this.order_total_count = response.data.result.pagination.count_total
              this.show_message('搜索完成')
            } else {
              this.show_message('搜索失败: ' + response.data.msg, 'error')
            }
          } catch (error) {
            this.show_message('搜索出错: ' + error.message, 'error')
          }
        },

        // 查看订单详情
        view_order_detail(order) {
          this.selected_order = order
          this.show_order_detail_modal = true
        },

        // 关闭订单详情弹窗
        close_order_detail_modal() {
          this.show_order_detail_modal = false
          this.selected_order = null
        },

        // 更新订单状态
        update_order_status(order) {
          this.selected_order = order
          this.new_order_status = order.status
          this.show_update_status_modal = true
        },

        // 确认更新订单状态
        async confirm_update_order_status() {
          try {
            const response = await this.axios.post('/update_model_order_status', {
              order_number: this.selected_order.order_number,
              status: this.new_order_status,
            })
            if (response.data.code === 200) {
              this.show_message('订单状态更新成功')
              this.close_update_status_modal()
              this.find_list_model_order()
            } else {
              this.show_message('更新失败: ' + response.data.msg, 'error')
            }
          } catch (error) {
            this.show_message('更新出错: ' + error.message, 'error')
          }
        },

        // 关闭更新状态弹窗
        close_update_status_modal() {
          this.show_update_status_modal = false
          this.selected_order = null
          this.new_order_status = 'PAYING'
        },

        // 删除订单
        async delete_model_order(order_number) {
          if (!confirm('确定要删除这个订单吗？')) {
            return
          }

          try {
            const response = await this.axios.get(`/delete_model_order?order_number=${order_number}`)
            if (response.data.code === 200) {
              this.show_message('删除成功')
              this.find_list_model_order()
            } else {
              this.show_message('删除失败: ' + response.data.msg, 'error')
            }
          } catch (error) {
            this.show_message('删除出错: ' + error.message, 'error')
          }
        },

        // 订单分页跳转
        go_to_order_page(page) {
          this.order_search_form.page_index = page
          this.find_list_model_order()
        },
      },

      mounted() {
        // 页面加载时自动加载商品列表和分类树
        this.find_list_model_product()
        this.get_kind_tree()
      },
    })
  </script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* 商品卡片内容布局 */
    .product_card_content {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    /* 商品图片样式 */
    .product_image_section {
      flex-shrink: 0;
      text-align: center;
    }

    .product_image {
      width: 100px;
      height: 100px;
      border-radius: 8px;
      overflow: hidden;
      background: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .product_image img {
      width: 100px;
      height: 100px;
      object-fit: cover;
    }

    .product_image_placeholder {
      width: 100px;
      height: 100px;
      border-radius: 8px;
      background: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
      font-size: 14px;
      border: 2px dashed #ddd;
    }

    /* 商品信息区域 */
    .product_info_section {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* 产品卡片头部 */
    .product_header {
      margin-bottom: 5px;
    }

    .product_header h4 {
      margin: 0;
      color: #333;
      font-size: 18px;
      font-weight: 600;
    }

    /* 产品内容 */
    .product_content {
      margin-bottom: 15px;
    }

    .product_remark {
      color: #666;
      font-size: 13px;
      margin: 8px 0;
      line-height: 1.4;
    }

    .product_prices {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin: 10px 0;
    }

    .price_item {
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: 500;
    }

    .price_item.personal {
      background: #e8f5e8;
      color: #2d5a2d;
    }

    .price_item.company {
      background: #e3f2fd;
      color: #1565c0;
    }

    .price_item.extend {
      background: #fff3e0;
      color: #ef6c00;
    }

    /* 模型属性标签 */
    .product_attributes {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin: 10px 0;
    }

    .attribute_tag {
      background: #e9ecef;
      color: #495057;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
      border: 1px solid #dee2e6;
    }

    .attribute_tag.skeleton {
      background: #fff3cd;
      color: #856404;
      border-color: #ffeaa7;
    }

    .attribute_tag.animation {
      background: #d1ecf1;
      color: #0c5460;
      border-color: #bee5eb;
    }

    .attribute_tag.business {
      background: #f8d7da;
      color: #721c24;
      border-color: #f5c6cb;
    }

    .attribute_tag.print {
      background: #d4edda;
      color: #155724;
      border-color: #c3e6cb;
    }

    .attribute_tag.no_collapse {
      background: #cce5ff;
      color: #004085;
      border-color: #b3d7ff;
    }

    /* 统计信息 */
    .product_stats {
      display: flex;
      gap: 15px;
      font-size: 12px;
      color: #666;
      margin: 10px 0;
    }

    /* 购物车卡片 */
    .cart_header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .price_type {
      background: #6f42c1;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
    }

    .cart_content {
      margin-bottom: 15px;
    }

    .cart_price_info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 8px 0;
    }

    .cart_price {
      font-weight: 600;
      color: #e74c3c;
      font-size: 14px;
    }

    .price_type_badge {
      background: #6f42c1;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
    }

    /* 订单卡片 */
    .order_header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .order_status {
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
    }

    .order_status.paying {
      background: #fff3cd;
      color: #856404;
    }

    .order_status.payed {
      background: #d4edda;
      color: #155724;
    }

    .order_status.shipped {
      background: #cce5ff;
      color: #004085;
    }

    .order_status.cancelled {
      background: #f8d7da;
      color: #721c24;
    }

    .order_content {
      margin-bottom: 15px;
    }

    .order_info {
      margin-bottom: 15px;
    }

    .order_info div {
      margin: 5px 0;
      font-size: 13px;
      color: #666;
    }

    .order_items_preview {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 6px;
      border-left: 3px solid #667eea;
    }

    .order_items_preview h5 {
      margin: 0 0 8px 0;
      font-size: 14px;
      color: #333;
    }

    .order_item {
      font-size: 12px;
      color: #666;
      margin: 3px 0;
    }

    .more_items {
      font-size: 11px;
      color: #999;
      font-style: italic;
      margin-top: 5px;
    }

    /* 分类相关样式 */
    .product_categories {
      margin: 10px 0;
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }

    .category_label {
      font-size: 12px;
      color: #666;
      font-weight: 500;
      min-width: 40px;
      margin-top: 2px;
    }

    .category_tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }
  </style>
</html>
