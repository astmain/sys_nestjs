//  prisma使用规范
generator client {
  provider = "prisma-client-js"
}

datasource db {
  // provider = "sqlite" //  使用sqlite时无法用JSON{},只能使用JSON[]
  // url      = "file:./sqlite.db" //  E:/AAA/dayu_sys/dayu_sys02/demo5/make_orm_prisma/sqlite.db
  provider = "postgresql"
  url      = env("VITE_url_db_pg")
}

// ========================模型订单数据库表 开始===================================

// 订单状态枚举
enum enum_order_status {
  model_pendingPayment //待支付
  model_purchased //已购买
  model_canceled //已取消
}

// 模型商品表
model tb_model_product {
  id      String @id @default(cuid())
  user_id Int //用户id
  title   String //标题
  remark  String @default("") //备注

  price_personal Int @default(0) //个人价格
  price_company  Int @default(0) //企业价格
  price_extend   Int @default(0) //企业扩展价格

  list_img     Json @default("[]") //图片
  list_file    Json @default("[]") //文件
  list_video   Json @default("[]") //视频
  list_extend  Json @default("[]") //附件
  list_texture Json @default("[]") //贴图

  // 普通客户才能设置
  count_collect  Int @default(0) //收藏数
  count_download Int @default(0) //下载数
  count_like     Int @default(0) //点赞数

  // 管理员才能设置
  is_check_remark String  @default("") //审核备注
  is_check        Boolean @default(false) //是否审核

  is_public    Boolean @default(true) //是否公开
  is_deleted   Boolean @default(false) //逻辑删除
  model_format String  @default(".stl") //模型格式

  is_business Boolean @default(false) //是否商用

  is_skeleton    Boolean @default(false) //是否有骨骼
  is_animation   Boolean @default(false) //是否有动画
  is_print       Boolean @default(true) //是否可打印
  is_no_collapse Boolean @default(true) //未塌陷

  area_unit String @default("5k以下") //面片数
  wiring    String @default("三角形") //布线

  // count_store              Int                       @default(999999)// 库存
  tb_model_cart  tb_model_cart[] //购物车
  tb_order_infos tb_model_order_history[] //订单历史
  tb_model_kind  tb_model_kind[] //分类

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

// 模型购物车表
model tb_model_cart {
  id      String @id @default(cuid())
  user_id Int //用户id

  price_type String //价格类型
  product_id String //商品id

  count      Int              @default(1) //是商品的数量
  product    tb_model_product @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: Cascade) //商品
  updated_at DateTime         @updatedAt
  created_at DateTime         @default(now())
  is_deleted Boolean          @default(false) //逻辑删除
  // @@unique([user_id, product_id])
}

// 模型订单列表
model tb_model_order_list {
  order_number String @unique
  user_id      Int //用户id
  price_sub    Int //减去价格
  price_order  Int //订单价格
  price_pay    Int //支付价格

  pay_time               DateTime //支付时间
  tb_model_order_history tb_model_order_history[] //订单详情

  is_deleted Boolean           @default(false) //逻辑删除
  status     enum_order_status @default(model_pendingPayment) // 订单状态

  updated_at DateTime @updatedAt
  created_at DateTime @default(now())
}

// 模型订单历史
model tb_model_order_history {
  id Int @id @default(autoincrement())

  is_deleted Boolean @default(false) //逻辑删除

  // 历史购物车 json格式定档
  cart_history Json @default("{}") //购物车历史,记录购物车历史(包含商品,数量,价格类型)

  // 关联最新商品
  product_id       String //商品id                                 这个id以后要改掉
  tb_model_product tb_model_product @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: Cascade) //商品

  // 关联最新订单
  order_number        String //订单id    
  tb_model_order_list tb_model_order_list @relation(fields: [order_number], references: [order_number], onDelete: Cascade)
  // tb_model_order_list tb_model_order_list @relation(fields: [order_number], references: [order_number], onDelete: NoAction, onUpdate: Cascade) //订单
}

// 模型分类表
model tb_model_kind {
  id               Int                @id @default(autoincrement())
  name             String //名称
  is_deleted       Boolean            @default(false) //逻辑删除
  parent_id        Int? //父级id//  // 自关联
  parent           tb_model_kind?     @relation("re_tb_model_kind", fields: [parent_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  children         tb_model_kind[]    @relation("re_tb_model_kind")
  tb_model_product tb_model_product[] //商品
}

// ========================模型订单数据库表 结束===================================

// 测试表
model tb_demo {
  id             Int      @id @default(autoincrement())
  name           String   @default("")
  remark         String   @default("")
  is_deleted     Boolean  @default(false)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt
  price_personal Int      @default(0)
  price_company  Int      @default(0)
  price_extend   Int      @default(0)
  list_img       Json     @default("[]")
}
